<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.youngtvjobs.ycc.rental.rentalMapper">

	  <!-- 장소 대관 start -->	  
	  <!-- 기존 예약 데이터들을 불러옴 -->
	  <select id="selectInfo" resultType="RentalDto" parameterType="RentalDto">
	  	select * 
		from classroom c, prental_info p
		where c.croom_id = p.croom_id and
		p.croom_id = #{croom_id} and p.prental_de = #{prental_de}
	  </select>
	  
	  <!-- 선택한 예약 정보들을 insert -->
	  <insert id="insertInfo" parameterType="RentalDto">
		INSERT INTO public.prental_info
		(prental_de, user_id, croom_id, time1, time2, time3, time4, time5, time6)
		VALUES(#{prental_de}, #{user_id}, #{croom_id}, #{time1}, #{time2}, #{time3}, #{time4}, #{time5}, #{time6})
	  </insert>
	  
	  <!-- selectBox에서 장소 고를때 장소를 불러오는 sql문 -->
	  <select id="selectRentalPlace" resultType="RentalDto">
	  	select croom_id, croom_location, croom_name 
	  	from classroom
	  </select>
	  
	  <!-- 독서실 start -->
	  <!-- 각 좌석마다 예약현황을 확인하기 위한 select -->
	  <select id="selectSchedule" resultType="RentalDto">
	  	SELECT * from studyroom order by sroom_seat_id
	  </select>
	  
	  <!-- 해당 좌석에서 예약을 진행할때 사용하는 insert -->
	  <insert id="studyroomRental" parameterType="RentalDto">
	  	INSERT INTO public.sroom_rental_info
		(sroom_rental_stime, sroom_rental_etime, user_id, sroom_seat_id)
		VALUES(now(), #{sroom_rental_etime}, #{user_id}, #{sroom_seat_id})
	  </insert>
	  
	  <!-- 예약 시간이 종료되었을 때 진행되는 delete -->
	  <delete id="studyroomReset" parameterType="RentalDto">
	  	delete from sroom_rental_info 
		where sroom_rental_etime <![CDATA[ < ]]> 'now()'
	  </delete>

      <!-- 예약 insert시 n을 y로 update하는 sql -->		
	  <update id="studyroomRentalupdate" parameterType="RentalDto">
	  	UPDATE public.studyroom
		SET sroom_rental_yn='y'
		WHERE sroom_seat_id=#{sroom_seat_id}
	  </update>
	  
	  <!-- 예약시간이 만료되어 delete시 y을 n으로 update하는 sql -->		
	  <update id="studyroomDeleteupdate" parameterType="RentalDto">
	  	UPDATE public.studyroom
		SET sroom_rental_yn='n'
	  </update>
	  
	  <!-- 비교하기 위해 현재 예약 현황 select하는 sql -->
	  <select id="rentaledSelect" resultType="RentalDto">
	  	SELECT sroom_seat_id from sroom_rental_info order by sroom_seat_id
	  </select>
	  
	  <!-- y를n으로 바꾸기 위해 현재 y로 되어있는 부분 select하는 sql -->
	  <select id="seatstatusy" resultType="RentalDto">
	  	select sroom_seat_id from studyroom where sroom_rental_yn='y' order by sroom_seat_id
	  </select>
	  
  </mapper>